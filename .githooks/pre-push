#!/usr/bin/env bash
set -euo pipefail

echo "[pre-push] Building site with local Forester before push..."

npm run build

if [ ! -d output ] || [ -z "$(ls -A docs)" ]; then
  echo "[pre-push] Forester build did not produce the output directory." >&2
  exit 1
fi

if [ ! -f output/index.html ]; then
  echo "[pre-push] output/index.html missing after build; stopping push." >&2
  exit 1
fi

# Keep hook fast by skipping push if build left unstaged changes.
if ! git diff --quiet -- output; then
  echo "[pre-push] output/ has changes. Stage/commit them before pushing." >&2
  exit 1
fi
